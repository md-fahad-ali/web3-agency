import{useApi as e,defineModule as n}from"@directus/extensions-sdk";import{defineComponent as t,ref as r,computed as a,resolveComponent as o,openBlock as l,createBlock as i,withCtx as s,createVNode as d,createCommentVNode as u,createElementVNode as c,createElementBlock as p,Fragment as v,renderList as f,unref as m,toDisplayString as h,createTextVNode as b}from"vue";import{useI18n as y}from"vue-i18n";const g=c("p",null,"Here you can switch between available roles assigned to you by the admin.",-1),x=c("p",null,"If you do not see a role that you believe you should have, please contact the admin.",-1),_={class:"available-roles"},w={class:"role-description"},k={class:"role--actions"};var C=t({__name:"module",setup(n){const t=r([]),C=r([]),S=r(""),A=r(null),T=a((()=>C.value?t.value.filter((e=>C.value.includes(e.id))):t.value)),j=e(),{t:E}=y();return j.get("/users/me",{params:{fields:["role","roles.role"]}}).then((({data:{data:e}})=>{var n;S.value=e.role,C.value=null==(n=e.roles)?void 0:n.map((e=>e.role))})),j.get("/roles",{params:{fields:["id","name","icon","description"]}}).then((({data:{data:e}})=>t.value=e)),(e,n)=>{const t=o("v-sheet"),r=o("v-error"),a=o("v-button"),y=o("v-info"),C=o("private-view");return l(),i(C,{title:"Choose role",id:"role-chooser"},{navigation:s((()=>[d(t,null,{default:s((()=>[g,x])),_:1})])),default:s((()=>[A.value?(l(),i(r,{key:0,error:A.value,onClick:n[0]||(n[0]=e=>A.value=null)},null,8,["error"])):u("v-if",!0),c("div",_,[(l(!0),p(v,null,f(m(T),(e=>(l(),i(y,{key:e.id,icon:e.icon,title:e.name,class:"role"},{default:s((()=>[c("p",w,h(e.description),1),c("div",k,[d(a,{disabled:e.id===S.value,onClick:n=>async function(e){try{await j.patch("/users/me",{role:e.id}),location.reload()}catch(e){A.value=e.toString()}}(e)},{default:s((()=>[b(h(m(E)("Select")),1)])),_:2},1032,["disabled","onClick"])])])),_:2},1032,["icon","title"])))),128))])])),_:1})}}}),S=[],A=[];!function(e,n){if(e&&"undefined"!=typeof document){var t,r=!0===n.prepend?"prepend":"append",a=!0===n.singleTag,o="string"==typeof n.container?document.querySelector(n.container):document.getElementsByTagName("head")[0];if(a){var l=S.indexOf(o);-1===l&&(l=S.push(o)-1,A[l]={}),t=A[l]&&A[l][r]?A[l][r]:A[l][r]=i()}else t=i();65279===e.charCodeAt(0)&&(e=e.substring(1)),t.styleSheet?t.styleSheet.cssText+=e:t.appendChild(document.createTextNode(e))}function i(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),n.attributes)for(var t=Object.keys(n.attributes),a=0;a<t.length;a++)e.setAttribute(t[a],n.attributes[t[a]]);var l="prepend"===r?"afterbegin":"beforeend";return o.insertAdjacentElement(l,e),e}}("\n/* Hide the sidebar and toggle actions */\n#role-chooser .actions,\n#role-chooser aside#sidebar,\n#role-chooser .sidebar-overlay {\n  display: none !important;\n}\n.available-roles {\n  display: flex;\n  align-items: stretch;\n  justify-content: space-around;\n  flex-wrap: wrap;\n}\n.available-roles>.role {\n  flex: 1 1 30%;\n  min-width: 300px;\n  margin: 1rem;\n  padding: var(--input-padding);\n  border: var(--border-width) solid var(--border-normal);\n  border-radius: var(--border-radius);\n}\n.available-roles>.role>.content {\n  display: flex;\n  flex-direction: column;\n  flex: 1;\n}\n.available-roles>.role .role-description {\n  flex-grow: 1;\n}\n.available-roles>.role .role--actions {\n  padding-top: var(--input-padding);\n}\n",{}),C.__file="src/module.vue";var T=n({id:"role-chooser",name:"Role Chooser",icon:"security",routes:[{path:"",component:C}],preRegisterCheck:(e,n)=>!!e.role.admin_access||!!n.find((e=>{var n;return"directus_users"===e.collection&&"update"===e.action&&(null==(n=e.fields)?void 0:n.includes("role"))}))});export{T as default};
